# This workflow will build a Java project with Maven
# For more information see: https://help.github.com/actions/language-and-framework-guides/building-and-testing-java-with-maven

name: Maven Test Build

on:
  push:
  workflow_dispatch:

jobs:
  maven_build:
    name: Maven-Build (Linux)
    runs-on: ubuntu-latest

    steps:
      - name: Start Redpanda
        run: |
          docker run -d --name=redpanda \
            -p 9092:9092 \
            docker.redpanda.com/redpandadata/redpanda:latest \
            redpanda start \
              --overprovisioned \
              --smp 1 \
              --memory 1G \
              --reserve-memory 0M \
              --node-id 0 \
              --check=false \
              --kafka-addr PLAINTEXT://0.0.0.0:9092
          
          echo "Waiting for Redpanda to start..."
          sleep 10
          docker logs redpanda | tail -n 20

      - uses: actions/checkout@v5
      - name: Set up JDK 17
        uses: actions/setup-java@v5
        with:
          distribution: 'temurin'
          java-version: 17
      - name: Build with Maven
        run: mvn -B install --file pom.xml
